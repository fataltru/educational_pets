# Анализ оттока клиентов банка

## Описание и задача проекта

Требуется проанализировать результаты ab эксперимента. Эксперимент проходил с 2023-08-29 по 2023-09-04 включительно. Для эксперимента были задействованы 2 (новый рекомендательный алгоритм) и 1 (контрольная) группы. 

Основная гипотеза заключается в том, что новый алгоритм во 2-й группе приведет к увеличению CTR.

## [Краткий план действий по основной части AB теста](https://github.com/fataltru/educational_pets/blob/main/pets/kc/01_ab_test/ab_test/ab_test_analysis.ipynb)
    1. Загрузка данных и подготовка их к исследованию
    2. Проверка результатов (сравнение CTR) AB теста через следующие стат.тесты:
	1. t-тест на обычном CTR
	2. t-тест на сглаженном CTR
	3. Тест Манна-Уитни на обычном CTR
	4. Пуассоновский бутстреп
	5. t-тест и тест Манна-Уитни поверх бакетного преобразования
    3. Сформулируем выводы на основании проведенных тестов

## [Изучение метрики линеаризованных лайков](https://github.com/fataltru/educational_pets/blob/main/pets/kc/01_ab_test/ab_test/ab_test_linearized_likes.ipynb)
   1. Загрузка данных и подготовка их к исследованию
   2. Проведем t-тест на обычном CTR и на линеаризованных лайках
   3. Сделаем выводы по полученным результатам

## Используемые инструменты
- Pandas, Numpy, Matplotlib, Seaborn, scipy.stats (проверка гипотез), pandahouse, swifter, hashlib


## Общий вывод

### По основной части AB теста

У нас имеется 19 897 записей (пользователей), которые делятся на две группы.
- Группа 1 (контрольная A) - включает в себя 10020 записей
- Группа 2 (тестовая B) - включает в себя 9877 записи

Средние CTR по группам
exp_group
1. 0.216774
2. 0.216102

Далее проводился ряд статистических тестов, уровень стат.значимости равен 0.05

**Результат t-теста на обычном CTR был следующим**
- p_value = 0.685373331140751

**Этим же тестом был проверен сглаженный CTR:**
- p_value = 0.05166679015318526 сглаженный

Оба раза тест не зафиксировал статистически значимых отклонений, не смотря на то, что тест на сглаженном CTR при уровне стат.значимости 0.1 зафиксировал бы разницу. Результаты теста можно объяснить скошенностью распределения тестовой группы, т.е. из за специфичного распределения группы B (имеет второй горб в диапазоне 0.2-0.4 и так сказать скошенность вправо) средняя уравнивается со средним контрольной группы.

**Так же был, над обычным CTR был проведен тест основанный на критерии Манна-Уитни:**
- p_value = 4.632205841806026e-45

Результат данного теста стоит воспринимать с осторожностью, т.к. одно из требований теста Манна-Уитни это схожесть распределений, чего в нашем случае нет.

**Пуассоновский бутстреп**

Было выполненно 2000 симуляций на каждую группу, т.е. было получено 4000 CTR (по 2000 на каждую группу). Ввиду того, что на графике мы видим, что распределения не пересекаются (распределение разницы нам это показывает наглядно), мы можем утрвеждать что ctr прошедший через бутстреп показывает, что контрольная группа А показывает лучшие результаты метрики CTR, чем тестовая

**Бакетное преобразование**
Среднии значения CTR группы A(1) и B(2) после бакетного преобразования

1. 0.209689
2. 0.200451

Над полученными корзинами было проведено два теста:

- С помощью t-теста было получено p_value = 1.4585030295061888e-06
- С помощью теста Манна-Уитни было получено p_value = 4.586985687766298e-07

Оба теста зафиксировали статистически значимую разницу между группами, как следствие можно отклонить нулевую гипотезу о равенстве средних

На основании вышесказанного можно сделать следующий вывод:
Новый рекомендательный алгоритм разделил тестовую группу на 2 части, на тех у кого CTR сдвинулся вправо и на тех у кого CTR сдвинулся влево относительно большей части распределения контрольной группы. При этом по гистограмме количества просмотров на 1 пользователя нельзя сказать, что есть какое-то падение просмотра у тех пользователей группы B, CTR которых находится слева от основной части распределения. 

Статистические тесты же, особенно бутсреп, т-тест и тест Манна - Уитни поверх бакетного преобразования обнаружили статистически значимую разницу между средними двух групп в пользу контрольной группы.

На текущий момент я бы не рекомендовал раскатывать данный алгоритм на всех пользователей. Возможно стоит попробовать выяснить причину, почему произошло разделение группы B на так сказать две части пользователей, чтобы выявить причину падения CTR и по возможности внести изменения, оставив при этом те причины, которые у другой части привели к увеличению CTR

### По изучению метрики линеаризованных лайков

У группы 0 и 3 различия были зафиксированы и по метрики CTR и по метрики linearized_likes, при этом для второй метрики p-value получился меньше чем для CTR

У группы 1 и 2 t-тест по метрики CTR различий не показал, а вот по метрики linearized_likes были зафиксированы статистически значимые различия.

Так же стоит заметить, что форма распределения (особенно видно у пары групп 1 и 2) меняется у метрики linearized_likes относительно CTR, особенно у пользователей у которых много просмотров но мало лайков. Тем самым она подчеркивает различия сильнее чем CTR (другими словами является более чувствительной), что дает возможность t-тестам увидеть разницу.

